{
  "hash": "49262cc03ebbdcdc65e559d4836906f6",
  "result": {
    "markdown": "\n# Part1:Think about example from previous chapter (parking spots) and draw the DAG.\nLoad necessary libraries\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-1_b76c9f5dc25e63a888a0cc2793988b6b'}\n\n```{.r .cell-code}\nlibrary(tidyverse)    # For data manipulation and visualization\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.3     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)      # For working with Directed Acyclic Graphs (DAGs)\nlibrary(ggdag)        # For DAG visualization with ggplot2\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\n# Construct DAG for Sales Example\nsales_graph <- dagify(\n  product_sales ~ parking_capacity,\n  product_sales ~ store_location,\n  parking_capacity ~ store_location, # store_location acts as the confounding variable\n  labels = c(\n    \"product_sales\" = \"Product Sales\",\n    \"parking_capacity\" = \"Parking \\n Capacity\",\n    \"store_location\" = \"Store Location\"\n  )\n)\nggdag(sales_graph, use_labels = \"label\", text = FALSE)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n# Part2.1\nLoad the data file customer_sat.rds. A company sells a SaaS (Software as a service) to business clients that chose to subscribe to one of the three subscription levels, Starter, Premium or Elite, which provide different features at different price points (more storage and other capabilities). Starter has the least functionality, while Elite includes the most features.\n\nNow imagine, you are working as an analyst for that company and are asked to examine the relationship between follow-up calls to the clients and their satisfaction with the product and service. Follow-up calls are voluntary and are just to help the client with possible problems and so on. Satisfaction is measured on a weekly basis by surveying the clients.\n\nIn the data, you find three variables: satisfaction, follow_ups and subscription. Perform the following steps:\n\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_2c5c3c7bde1fb94c98ad03b03ec756b3'}\n\n```{.r .cell-code}\n#Load the customer satisfaction data\ncustomer_data <- readRDS('C:/Users/user/Documents/TUHH/Causal/Causal_Data_Science_Data/customer_sat.rds')\ncustomer_data\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"follow_ups\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satisfaction\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"subscription\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"8\",\"2\":\"40\",\"3\":\"Elite\"},{\"1\":\"7\",\"2\":\"45\",\"3\":\"Elite\"},{\"1\":\"8\",\"2\":\"47\",\"3\":\"Elite\"},{\"1\":\"9\",\"2\":\"44\",\"3\":\"Elite\"},{\"1\":\"10\",\"2\":\"50\",\"3\":\"Elite\"},{\"1\":\"6\",\"2\":\"55\",\"3\":\"Premium+\"},{\"1\":\"7\",\"2\":\"60\",\"3\":\"Premium+\"},{\"1\":\"6\",\"2\":\"62\",\"3\":\"Premium+\"},{\"1\":\"8\",\"2\":\"59\",\"3\":\"Premium+\"},{\"1\":\"8\",\"2\":\"65\",\"3\":\"Premium+\"},{\"1\":\"0\",\"2\":\"70\",\"3\":\"Premium\"},{\"1\":\"1\",\"2\":\"74\",\"3\":\"Premium\"},{\"1\":\"2\",\"2\":\"77\",\"3\":\"Premium\"},{\"1\":\"2\",\"2\":\"74\",\"3\":\"Premium\"},{\"1\":\"3\",\"2\":\"80\",\"3\":\"Premium\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Explore the data\nhead(customer_data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"follow_ups\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satisfaction\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"subscription\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"8\",\"2\":\"40\",\"3\":\"Elite\"},{\"1\":\"7\",\"2\":\"45\",\"3\":\"Elite\"},{\"1\":\"8\",\"2\":\"47\",\"3\":\"Elite\"},{\"1\":\"9\",\"2\":\"44\",\"3\":\"Elite\"},{\"1\":\"10\",\"2\":\"50\",\"3\":\"Elite\"},{\"1\":\"6\",\"2\":\"55\",\"3\":\"Premium+\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n# Fit a regression model: satisfaction ~ follow-ups\n\n## Simple linear Regression ##\nmodel_unadjusted <- lm(satisfaction ~ follow_ups, data = customer_data)\n\nsummary(model_unadjusted)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups, data = customer_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -12.412  -5.257   1.733   4.506  12.588 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  78.8860     4.2717  18.467 1.04e-10 ***\n#> follow_ups   -3.3093     0.6618  -5.001 0.000243 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.923 on 13 degrees of freedom\n#> Multiple R-squared:  0.658,\tAdjusted R-squared:  0.6316 \n#> F-statistic: 25.01 on 1 and 13 DF,  p-value: 0.0002427\n```\n:::\n:::\n\n# Part2.2\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-3_5370a34e61fd4c5e4c3ffecce680fb01'}\n\n```{.r .cell-code}\n# Fit a regression model: satisfaction ~ follow-ups + subscription\n\n## Multiple Linear Regression\nmodel_adjusted <- lm(satisfaction ~ follow_ups + subscription, data = customer_data)\n\nsummary(model_adjusted)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups + subscription, data = customer_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -4.3222 -2.1972  0.3167  2.2667  3.9944 \n#> \n#> Coefficients:\n#>                      Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)           26.7667     6.6804   4.007  0.00206 ** \n#> follow_ups             2.1944     0.7795   2.815  0.01682 *  \n#> subscriptionPremium   44.7222     5.6213   7.956 6.88e-06 ***\n#> subscriptionPremium+  18.0722     2.1659   8.344 4.37e-06 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 2.958 on 11 degrees of freedom\n#> Multiple R-squared:  0.9597,\tAdjusted R-squared:  0.9487 \n#> F-statistic: 87.21 on 3 and 11 DF,  p-value: 5.956e-08\n```\n:::\n:::\n\n\n# Part3: Compare coefficients from the two models\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-4_97beedc97d201e7144ffc18489e518ce'}\n\n```{.r .cell-code}\ncoef_comparison <- data.frame(\n  Model = c(\"Model 1\", \"Model 2\"),\n  Intercept = c(coef(model_unadjusted)[1], coef(model_adjusted)[1]),\n  FollowUps = c(coef(model_unadjusted)[2], coef(model_adjusted)[2]),\n  PremiumPlus = c(0, coef(model_adjusted)[grep(\"subscription_typePremium\\\\+\", names(coef(model_adjusted)))]),\n  Elite = c(0, coef(model_adjusted)[grep(\"subscription_typeElite\", names(coef(model_adjusted)))])\n)\n\nprint(coef_comparison)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     Model Intercept FollowUps PremiumPlus Elite\n#> 1 Model 1  78.88605 -3.309302           0     0\n#> 2 Model 2  26.76667  2.194444           0     0\n```\n:::\n:::\n\n\nModel 2 exhibits a lower baseline satisfaction compared to Model 1, attributed to its reduced intercept.\nIncorporating subscription information altered the direction of the association between Follow-ups and satisfaction, shifting it from negative to positive.\nPremiumPlus subscription has a positive influence on satisfaction, while there is no supplementary effect observed for the Elite subscription level.\")\n\n\n# Part4:Visualize the data\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-5_fb2aaf9ed0512ab0b4ae6183b300111a'}\n\n```{.r .cell-code}\n### Simpson's Paradox: Subscription as the Confounding Variable ###\n\n\n## Without conditioning on subscription\n\nsimps_not_cond <- ggplot(customer_data, aes(x = follow_ups, y = satisfaction)) +\n  geom_point(alpha = 0.8) +\n  stat_smooth(method = \"lm\", se = F) +\n  labs(title = \"Relationship between Follow-ups and Satisfaction\",\n       x = \"Follow-up Calls\",\n       y = \"Customer Satisfaction\") +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n\n\n## Conditioning on subscription\n\nsimps_cond <- ggplot(customer_data, aes(x = follow_ups, y = satisfaction, color = subscription)) +\n  geom_point(alpha = 0.8) +\n  stat_smooth(method = \"lm\", se = F, size = 1) +\n  labs(title = \"Relationship between Follow-ups and Satisfaction by Subscription Type\",\n       x = \"Follow-up Calls\",\n       y = \"Customer Satisfaction\",\n       color = \"Subscription Type\") +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `linewidth` instead.\n```\n:::\n\n```{.r .cell-code}\nsimps_not_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsimps_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}