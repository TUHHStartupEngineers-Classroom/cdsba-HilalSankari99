{
  "hash": "d0a9f25c1938b2290b8995eebe889c8d",
  "result": {
    "markdown": "---\ntitle: \"Directed Acyclic Graphs - Assignment 5\"\nauthor: \"Hilal Sankari\"\nformat: \n    html:\n      code-line-numbers: true\n      df-print: paged\n\n---\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-1_8740d83dd62dd4805a043bf49c99d1af'}\n\n```{.r .cell-code}\n# Load necessary libraries\nlibrary(tidyverse)    # For data manipulation and visualization\nlibrary(dagitty)      # For working with Directed Acyclic Graphs (DAGs)\nlibrary(ggdag)        # For DAG visualization with ggplot2\n```\n:::\n\n# **Part1**\n#### **Draw DAG**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_9b100f3bddbd29b578db104c29462ece'}\n\n```{.r .cell-code}\n# Construct DAG for Sales Example\nsales_graph <- dagify(\n  product_sales ~ parking_capacity,\n  product_sales ~ store_location,\n  parking_capacity ~ store_location, # store_location acts as the confounding variable\n  labels = c(\n    \"product_sales\" = \"Product Sales\",\n    \"parking_capacity\" = \"Parking \\n Capacity\",\n    \"store_location\" = \"Store Location\"\n  )\n)\nggdag(sales_graph, use_labels = \"label\", text = FALSE)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n# **Part2**\n\n#### **Read and Explore Data**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-3_e7930897e1924655d9d905f3a4183755'}\n\n```{.r .cell-code}\n# Load the customer satisfaction data\ncustomer_data <- readRDS('C:/Users/user/Documents/TUHH/Causal/Causal_Data_Science_Data/customer_sat.rds')\n# Explore the data\nhead(customer_data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"follow_ups\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"satisfaction\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"subscription\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"8\",\"2\":\"40\",\"3\":\"Elite\"},{\"1\":\"7\",\"2\":\"45\",\"3\":\"Elite\"},{\"1\":\"8\",\"2\":\"47\",\"3\":\"Elite\"},{\"1\":\"9\",\"2\":\"44\",\"3\":\"Elite\"},{\"1\":\"10\",\"2\":\"50\",\"3\":\"Elite\"},{\"1\":\"6\",\"2\":\"55\",\"3\":\"Premium+\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n# **Part2.1**\n\n#### **Fit a regression model: satisfaction ~ follow-ups**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-4_e4dcd30fba2fdca520e2d09a05464f25'}\n\n```{.r .cell-code}\n## Simple linear Regression ##\nmodel_unadjusted <- lm(satisfaction ~ follow_ups, data = customer_data)\n\nsummary(model_unadjusted)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups, data = customer_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -12.412  -5.257   1.733   4.506  12.588 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  78.8860     4.2717  18.467 1.04e-10 ***\n#> follow_ups   -3.3093     0.6618  -5.001 0.000243 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.923 on 13 degrees of freedom\n#> Multiple R-squared:  0.658,\tAdjusted R-squared:  0.6316 \n#> F-statistic: 25.01 on 1 and 13 DF,  p-value: 0.0002427\n```\n:::\n:::\n\n# **Part2.2**\n\n#### **Fit a regression model: satisfaction ~ follow-ups + subscription**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-5_41ad869c31ec8fd374bfd579635a4046'}\n\n```{.r .cell-code}\n## Multiple Linear Regression\nmodel_adjusted <- lm(satisfaction ~ follow_ups + subscription, data = customer_data)\n\nsummary(model_adjusted)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups + subscription, data = customer_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -4.3222 -2.1972  0.3167  2.2667  3.9944 \n#> \n#> Coefficients:\n#>                      Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)           26.7667     6.6804   4.007  0.00206 ** \n#> follow_ups             2.1944     0.7795   2.815  0.01682 *  \n#> subscriptionPremium   44.7222     5.6213   7.956 6.88e-06 ***\n#> subscriptionPremium+  18.0722     2.1659   8.344 4.37e-06 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 2.958 on 11 degrees of freedom\n#> Multiple R-squared:  0.9597,\tAdjusted R-squared:  0.9487 \n#> F-statistic: 87.21 on 3 and 11 DF,  p-value: 5.956e-08\n```\n:::\n:::\n\n# **Part3**\n\n#### **Compare coefficients from the two models**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-6_f85136b18a71fd760b24c274b69a8f05'}\n\n```{.r .cell-code}\ncoef_comparison <- data.frame(\n  Model = c(\"Model 1\", \"Model 2\"),\n  Intercept = c(coef(model_unadjusted)[1], coef(model_adjusted)[1]),\n  FollowUps = c(coef(model_unadjusted)[2], coef(model_adjusted)[2]),\n  PremiumPlus = c(0, coef(model_adjusted)[grep(\"subscription_typePremium\\\\+\", names(coef(model_adjusted)))]),\n  Elite = c(0, coef(model_adjusted)[grep(\"subscription_typeElite\", names(coef(model_adjusted)))])\n)\n\nprint(coef_comparison)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>     Model Intercept FollowUps PremiumPlus Elite\n#> 1 Model 1  78.88605 -3.309302           0     0\n#> 2 Model 2  26.76667  2.194444           0     0\n```\n:::\n:::\n\n::: {.callout-important appearance=\"minimal\"}\nModel 2 exhibits a lower baseline satisfaction compared to Model 1, attributed to its reduced intercept.\nIncorporating subscription information altered the direction of the association between Follow-ups and satisfaction, shifting it from negative to positive.\nPremiumPlus subscription has a positive influence on satisfaction, while there is no supplementary effect observed for the Elite subscription level.\n:::\n\n# **Part4**\n\n#### **Visualise Data**\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-7_c0a77bb3c4cd78b7c36dcb886c1c5956'}\n\n```{.r .cell-code}\n### Simpson's Paradox: Subscription as the Confounding Variable ###\n\n\n## Without conditioning on subscription\n\nsimps_not_cond <- ggplot(customer_data, aes(x = follow_ups, y = satisfaction)) +\n  geom_point(alpha = 0.8) +\n  stat_smooth(method = \"lm\", se = F) +\n  labs(title = \"Relationship between Follow-ups and Satisfaction\",\n       x = \"Follow-up Calls\",\n       y = \"Customer Satisfaction\") +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n\n\n## Conditioning on subscription\n\nsimps_cond <- ggplot(customer_data, aes(x = follow_ups, y = satisfaction, color = subscription)) +\n  geom_point(alpha = 0.8) +\n  stat_smooth(method = \"lm\", se = F, size = 1) +\n  labs(title = \"Relationship between Follow-ups and Satisfaction by Subscription Type\",\n       x = \"Follow-up Calls\",\n       y = \"Customer Satisfaction\",\n       color = \"Subscription Type\") +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n#> â„¹ Please use `linewidth` instead.\n```\n:::\n:::\n\n#### **Part 4 Results**\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-8_891d112a8e94d17a469d87a8f0067c6e'}\n\n```{.r .cell-code  code-fold=\"true\"}\nsimps_not_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code  code-fold=\"true\"}\nsimps_cond\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}